!function(t,e){"use strict";const n={config:{postsPerPage:7,defaultLanguage:"ar",supportedLanguages:["en","ar"],translations:{en:{loadMore:"Load More",loading:"Loading...",noMorePosts:"No more posts",copyLinkSuccess:"Article link copied",readingTime:"{} min read",gridView:"Grid View",listView:"List View",relatedPosts:"Suggested for you",errorOccurred:"An error occurred. Please try again."},ar:{loadMore:"تحميل المزيد",loading:"جاري التحميل...",noMorePosts:"لا توجد مزيد من المقالات",copyLinkSuccess:"تم نسخ رابط المقال",readingTime:"{} دقائق للقراءة",gridView:"عرض شبكي",listView:"عرض القائمة",relatedPosts:"مقترح لك",errorOccurred:"حدث خطأ. حاول مرة أخرى."}}},util:{isRTL:function(){return"rtl"===e.documentElement.dir},getLanguage:function(){const t=e.documentElement.lang.split("-")[0];return n.config.supportedLanguages.includes(t)?t:n.config.defaultLanguage},translate:function(t,e){const i=this.getLanguage();let s=n.config.translations[i][t]||t;return void 0!==e?s.replace("{}",e):s},fetchJSON:async function(t){try{const e=await fetch(t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return await e.json()}catch(t){throw t}},formatDate:function(t){const e=new Date(t),n=this.getLanguage();return e.toLocaleDateString("ar"===n?"ar-EG":"en-US",{year:"numeric",month:"long",day:"numeric"})},shuffleArray:function(t){for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t}},posts:{container:null,loadMoreButton:null,currentPage:1,isLoading:!1,isGridView:"false"!==localStorage.getItem("gridView"),authorImages:{},loadedPosts:new Set,init:function(){this.container=e.getElementById("articles-grid"),this.loadMoreButton=e.getElementById("load-more-button"),this.container&&this.loadMoreButton&&(this.loadMoreButton.addEventListener("click",this.loadMore.bind(this)),this.setupViewToggle(),this.applyCurrentView())},loadMore:async function(){if(this.isLoading)return;this.isLoading=!0;const t=this.loadMoreButton.textContent;this.loadMoreButton.innerHTML=t+" <span class='mask spin'></span>",this.loadMoreButton.disabled=!0;try{const e=await this.fetchPosts();if(!e||!e.feed||!e.feed.entry||0===e.feed.entry.length)return void this.showNoMorePosts();const n=e.feed.entry.filter((t=>!this.loadedPosts.has(t.id.$t)));for(let t=0;t<n.length;t++)this.container.insertAdjacentHTML("beforeend",'<div class="skeleton rounded-lg dark:bg-neutral-800 h-96"></div>');setTimeout((()=>{this.container.querySelectorAll(".skeleton").forEach((t=>t.remove())),n.forEach((t=>{const e=this.createPostElement(t);e&&(this.container.insertAdjacentElement("beforeend",e),this.loadedPosts.add(t.id.$t))})),this.currentPage++,this.isLoading=!1,this.loadMoreButton.innerHTML=t,this.loadMoreButton.disabled=!1,this.applyCurrentView()}),250)}catch(t){this.showError()}},fetchPosts:async function(){const i=new URLSearchParams(t.location.search).get("q"),s=t.location.pathname.split("/").pop(),o=null!==i,a=t.location.pathname.includes("/label/");let r=`${e.location.origin}/feeds/posts/summary?alt=json&orderby=published&start-index=${this.currentPage*n.config.postsPerPage+1}&max-results=${n.config.postsPerPage}`;return o?r+=`&q=${encodeURIComponent(i)}`:a&&(r+=`/-/${encodeURIComponent(s)}`),await n.util.fetchJSON(r)},createPostElement:function(t){if(!t)return null;const i=e.createElement("div");i.className="rounded-lg dark:bg-neutral-800";const s=t.title&&t.title.$t?t.title.$t:"No Title",o=t.link?t.link.find((t=>"alternate"===t.rel)).href:"#",a=t.media$thumbnail?t.media$thumbnail.url.replace(/\/s[0-9]+(\-c)?\//,"/s640/"):"https://via.placeholder.com/640x360";let r="No excerpt available";if(t.summary&&t.summary.$t)r=t.summary.$t;else if(t.content&&t.content.$t){const n=e.createElement("div");n.innerHTML=t.content.$t,r=n.textContent||n.innerText||""}r=r.substring(0,100).trim()+(r.length>100?"...":"");const l=t.author&&t.author[0]&&t.author[0].name?t.author[0].name.$t:"Unknown Author",d=t.published&&t.published.$t?t.published.$t:(new Date).toISOString(),c=n.util.formatDate(d);let u=this.getAuthorImage(t);return i.innerHTML=`\n          <div class="w-full h-60 rounded-t-lg">\n            <a aria-label="Image" href="${o}">\n              <img alt="${s}" class="object-cover w-full h-full rounded-t-lg nice-effect" src="${a}">\n            </a>\n          </div>\n          <div class="p-4 dark:bg-neutral-800">\n            <h3 class="text-lg font-semibold mb-5">\n              <a class="link-title" href="${o}">${s}</a>\n            </h3>\n            <p class="text-sm text-neutral-600 dark:text-neutral-300">${r}</p>\n            <div class="shrink-0 group block mt-4">\n              <div class="flex items-center">\n                <img alt="Avatar" class="inline-block shrink-0 w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 rounded-full" src="${u}">\n                <div class="rtl:mr-3 ltr:ml-3">\n                  <h3 class="font-semibold text-neutral-800 dark:text-neutral-300 text-sm sm:text-base">\n                    ${l}\n                  </h3>\n                  <time datetime="${d}" class="text-xs sm:text-sm text-neutral-500">\n                    ${c}\n                  </time>\n                </div>\n              </div>\n            </div>\n          </div>\n        `,i},getAuthorImage:function(t){const e=t.author[0].gd$image.src;if(this.authorImages[e])return this.authorImages[e];let n="https://lh3.googleusercontent.com/a/default-user";return e.includes("g/blank.gif")||e.includes("g/b16-rounded.gif")||(n=e.replace(/\/s\d+-c\//,"/s80-c/")),this.authorImages[e]=n,n},showNoMorePosts:function(){this.loadMoreButton.textContent=n.util.translate("noMorePosts"),this.loadMoreButton.disabled=!0,this.loadMoreButton.className="py-3 px-6 text-sm rounded-lg border border-primary text-primary cursor-not-allowed font-semibold text-center shadow-xs transition-all duration-500 bg-gray-300 text-gray-600",this.isLoading=!1},showError:function(){this.loadMoreButton.textContent=n.util.translate("errorOccurred"),this.loadMoreButton.classList.add("err"),setTimeout((()=>{this.loadMoreButton.textContent=n.util.translate("loadMore"),this.loadMoreButton.classList.remove("err"),this.loadMoreButton.disabled=!1}),1500)},setupViewToggle:function(){const t=e.getElementById("grid-icon"),n=e.getElementById("list-icon");t&&n&&(t.addEventListener("click",(()=>this.toggleView(!0))),n.addEventListener("click",(()=>this.toggleView(!1))))},toggleView:function(t){this.isGridView=t,localStorage.setItem("gridView",t),this.applyCurrentView()},applyCurrentView:function(){const t=e.getElementById("grid-icon"),n=e.getElementById("list-icon");t.classList.toggle("active",this.isGridView),n.classList.toggle("active",!this.isGridView),this.container.className="grid gap-6 "+(this.isGridView?"grid-cols-1 md:grid-cols-2":"grid-cols-1"),this.container.querySelectorAll(".rounded-lg.dark\\:bg-neutral-800").forEach((t=>{this.isGridView?(t.className="rounded-lg dark:bg-neutral-800",t.firstElementChild.className="w-full h-60 rounded-t-lg"):(t.className="rounded-lg flex dark:bg-neutral-800",t.firstElementChild.className="w-1/3 md:h-48 h-60 rounded-r-lg"),t.lastElementChild.className="p-4 dark:bg-neutral-800 "+(this.isGridView?"":"flex-1")}))}},relatedPosts:{container:null,init:function(){this.container=e.getElementById("enhancedblog-related-posts"),this.container&&"related"===this.container.getAttribute("data-bjs")&&this.loadRelatedPosts()},loadRelatedPosts:async function(){try{const t=this.container.getAttribute("data-id"),e=this.container.getAttribute("data-tags"),n=e?JSON.parse(e.replace(/&quot;/g,'"')):[],i=parseInt(this.container.getAttribute("data-max-results"),10)||15,s=parseInt(this.container.getAttribute("data-length"),10)||3;if(0===n.length)return void this.showPlaceholder();const o=await this.fetchRelatedPosts(n,i),a=this.filterAndShufflePosts(o.feed.entry,t,s);this.renderRelatedPosts(a)}catch(t){this.showErrorMessage()}},fetchRelatedPosts:async function(t,i){const s=t.map((t=>`label:"${t}"`)).join("|"),o=`${e.location.origin}/feeds/posts/default?alt=json&orderby=published&max-results=${i}&q=${encodeURIComponent(s)}`;return await n.util.fetchJSON(o)},filterAndShufflePosts:function(t,e,i){if(!t)return[];const s=t.filter((t=>t.id.$t!==e));return n.util.shuffleArray(s).slice(0,i)},renderRelatedPosts:function(t){if(!t||0===t.length)return void this.showPlaceholder();const n=e.createElement("div");n.className="mx-auto mt-3 grid max-w-2xl auto-rows-fr grid-cols-1 gap-4 sm:mt-6 lg:mx-0 lg:max-w-none lg:grid-cols-3",t.forEach((t=>{const e=this.createRelatedPostElement(t);n.appendChild(e)})),this.container.innerHTML="",this.container.appendChild(n)},createRelatedPostElement:function(t){const i=t.title.$t,s=t.link.find((t=>"alternate"===t.rel)).href,o=t.media$thumbnail?t.media$thumbnail.url.replace(/\/s[0-9]+(\-c)?\//,"/s300-c/"):"https://via.placeholder.com/300x200",a=t.author[0].name.$t,r=t.published.$t,l=n.util.formatDate(r),d=n.posts.getAuthorImage(t),c=e.createElement("article");return c.className="relative isolate flex flex-col justify-end overflow-hidden rounded-lg bg-gray-900 px-4 pb-4 pt-32 sm:pt-24 lg:pt-32",c.innerHTML=`\n          <img alt="" class="absolute inset-0 -z-10 h-full w-full object-cover" width="300" height="200" style="aspect-ratio: 300 / 200; object-fit: cover" src="${o}">\n          <div class="absolute inset-0 -z-10 bg-gradient-to-t from-gray-900 via-gray-900/40"></div>\n          <div class="absolute inset-0 -z-10 rounded-lg ring-1 ring-inset ring-gray-900/10"></div>\n          <div class="flex flex-wrap items-center gap-y-1 overflow-hidden text-sm leading-6 text-gray-300">\n            <time datetime="${r}" class="${n.util.isRTL()?"ml-4":"mr-4"}">${l}</time>\n            <div class="${n.util.isRTL()?"mr-2":"ml-2"} flex items-center gap-x-2 text-gray-500">\n              <span class="relative flex overflow-hidden rounded-full h-5 w-5 flex-none">\n                <img class="aspect-square h-full w-full" alt="${a}" src="${d}">\n              </span>\n              <span>${a}</span>\n            </div>\n          </div>\n          <h3 class="mt-2 text-base font-semibold leading-6 text-white">\n            <a href="${s}">${i}</a>\n          </h3>\n        `,c},showErrorMessage:function(){this.container.innerHTML='<p class="text-red-500">Error loading related posts. Please try again later.</p>'},showPlaceholder:function(){this.container.innerHTML='<p class="text-gray-500">No related posts found.</p>'}},postUtilities:{init:function(){this.setupCopyLink(),this.calculateReadingTime()},setupCopyLink:function(){const t=e.getElementById("copy-link-button");t&&t.addEventListener("click",this.copyPostUrl.bind(this))},copyPostUrl:function(){navigator.clipboard.writeText(t.location.href).then((()=>{this.showTooltip(n.util.translate("copyLinkSuccess"))})).catch((t=>{}))},showTooltip:function(t){const n=e.getElementById("copy-link-tooltip");n&&(n.textContent=t,n.classList.remove("opacity-0"),n.classList.add("opacity-100"),setTimeout((()=>{n.classList.remove("opacity-100"),n.classList.add("opacity-0")}),2e3))},calculateReadingTime:function(){const t=e.querySelector(".post-body"),i=e.getElementById("reading-time");if(t&&i){const e=(t.textContent||t.innerText).trim().split(/\s+/).length,s=Math.ceil(e/200);i.textContent=n.util.translate("readingTime",s)}}},init:function(){this.posts.init(),this.relatedPosts.init(),this.postUtilities.init()}};"loading"===e.readyState?e.addEventListener("DOMContentLoaded",n.init.bind(n)):n.init(),t.EnhancedBlog=n}(window,document);
